{"version":3,"file":"main.js","mappings":"mBAAO,IAAI,EAAY,GACZA,EAAO,SCGlB,SAASC,EACLC,EACAC,EACAC,EACAC,GAEA,MAAMC,EAAuB,iBAATH,EAAoBA,EAAO,OACzCI,EAAuB,iBAATJ,EAAoBA,EAAuB,iBAATC,EAAoBA,OAAOI,EAC3EC,EAA4B,kBAATN,EAAqBA,EAAuB,kBAATC,EAAqBA,EAAOC,IAAQ,EAEhGK,GAAGC,cAAcV,OCTd,YAAqBW,GACxB,IAAKC,EAAKN,GAAQK,EAElB,OADAC,EAAM,GAAG,KAAaA,IAClBN,EAAaO,KAAKC,KAAKC,OAAOH,EAAKN,GAChCO,KAAKC,KAAKE,SAASJ,EAC9B,CDI4BI,CAASf,EAAKK,GAAOD,EAAM,CAAEG,aACzD,CEXO,SAASS,EACZC,EACAC,EACAd,EAAyC,WAEzC,OAAOe,WAAWC,SAAS,EAAWH,EAAQC,EAAId,EACtD,CCiBA,SAASiB,EAAoCC,GACzC,GAAIC,KAAKC,SAAU,OAAOF,IAE1B,MAAMG,EAAQF,KAAKE,MACnB,IAAKA,IAAUA,EAAMC,SAAS,aAAc,OAAOJ,IAEnD,MAAMK,EAAQF,EAAME,MAEpBJ,KAAKK,OAAOC,YAAYC,MAAQH,EAAQ,EAAI,KAAOA,EAAQ,GAAK,EAAIA,EAAQ,GAAK,EAAI,EACrFJ,KAAKK,OAAOG,eAAeD,MACvBH,EAAQ,EAAI,KAAOA,EAAQ,GAAK,YAAcA,EAAQ,GAAK,mBAAqB,iBAEpFL,GACJ,CAEA,SAASU,EAAsCV,GAC3C,MAAMG,EAAQF,KAAKE,MACnB,IAAKA,IAAUA,EAAMC,SAAS,aAAc,OAAOJ,IAEnD,MAAMK,EAAQF,EAAME,MAEdM,EAASV,KAAKW,QAAQN,OAAOK,OAAOH,MAC1C,GAAIG,EAAOE,SAAS,eAAiBF,EAAOE,SAAS,QAAS,OAAOb,IAErEC,KAAKK,OAAOC,YAAYC,MAAQH,EAAQ,EAAI,KAAOA,EAAQ,GAAK,EAAIA,EAAQ,GAAK,EAAI,EACrFJ,KAAKK,OAAOQ,aAAaN,MAAQH,EAAQ,EAAI,KAAOA,EAAQ,GAAK,WAAaA,EAAQ,GAAK,kBAAoB,gBAE/GL,GACJ,CAEA,SAASe,IACL,MAAMC,EAAmBC,OAAOC,KAAKC,MAAMC,OAAOC,SAClD,OAAOpB,KAAKK,OAAOa,MAAME,SAASC,KAAIC,GAAKP,EAAiBO,IAChE,EJzDO,SAAqBC,EAAYC,GAAW,GAC1C,IAAW,EIAK,YJCrBjD,EAAOiD,EAAW,SAAW,QACjC,CIDAC,GAEAC,MAAMC,KAAK,oBAAoB,SAE/BD,MAAMC,KAAK,QAAQ,KACflC,EAAgB,oEAAqEgB,EAAqB,WAC1GhB,EACI,0EACAqB,EACA,YAEJrB,EAAgB,mEAAoEK,EAAoB,UAAU,IAGtH4B,MAAMC,KAAK,SAAS,KACXtC,KAAKuC,KAAKC,MAC4C,UAAvDxC,KAAKyC,SAASC,IAAI,OAAQ,2BAC1B1C,KAAKyC,SAASE,IAAI,OAAQ,wBAAyB,SHApD,YAAiB7C,GACpB,MAAOV,EAAKC,EAAMC,GAAQQ,EAC1BX,EAAOC,EAAK,OAAQC,EAAMC,EAC9B,CGFQ,CAAK,gB","sources":["webpack:///../../../../foundryVTT-projects/@utils/module.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/notification.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/localize.ts","webpack:///../../../../foundryVTT-projects/@utils/libwrapper.ts","webpack:///./src/main.ts"],"sourcesContent":["export let MODULE_ID = ''\r\nexport let TYPE = 'module'\r\n\r\nexport function setModuleID(id: string, isSystem = false) {\r\n    if (!MODULE_ID) MODULE_ID = id\r\n    TYPE = isSystem ? 'system' : 'module'\r\n}\r\n","import { localize } from '@utils/foundry/localize'\r\n\r\nexport type NotifyArgs = [str: string, arg1?: boolean | Record<string, string | number | boolean>, arg2?: boolean]\r\n\r\nfunction notify(\r\n    str: string,\r\n    arg1?: 'warning' | 'info' | 'error' | boolean | Record<string, string | number | boolean>,\r\n    arg2?: boolean | Record<string, string | number | boolean>,\r\n    arg3?: boolean\r\n) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { warn, NotifyArgs, info, error } from '@utils/foundry/notification'\r\n\r\nexport type LocalizeArgs = [key: string, data?: Record<string, string | number | boolean>]\r\n\r\nexport function localize(...args: LocalizeArgs) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function hasLocalization(key: string) {\r\n    return game.i18n.has(`${MODULE_ID}.${key}`, false)\r\n}\r\n\r\nexport function localizePath(key: string) {\r\n    return `${MODULE_ID}.${key}`\r\n}\r\n\r\nexport function localizeTemplate(key: string, { hash }: { hash: Record<string, string> }) {\r\n    return localize(`${key}`, hash)\r\n}\r\n\r\nexport function subLocalize(subKey: string) {\r\n    const fn = (...args: LocalizeArgs) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args: NotifyArgs) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args: NotifyArgs) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args: NotifyArgs) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: (key: string) => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: (key: string) => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key: string, { hash }: { hash: Record<string, string> }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn as ((...args: LocalizeArgs) => string) & {\r\n        warn: (...args: NotifyArgs) => void\r\n        info: (...args: NotifyArgs) => void\r\n        error: (...args: NotifyArgs) => void\r\n        has: (key: string) => boolean\r\n        path: (key: string) => string\r\n        template: (key: string, options: { hash: Record<string, string> }) => string\r\n    }\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function registerWrapper(target: string, fn: libWrapper.OverrideFunction, type: 'OVERRIDE'): number\r\nexport function registerWrapper(target: string, fn: libWrapper.WrappedFunction, type: 'WRAPPER' | 'MIXED'): number\r\nexport function registerWrapper(\r\n    target: string,\r\n    fn: libWrapper.WrappedFunction | libWrapper.OverrideFunction,\r\n    type: 'WRAPPER' | 'MIXED' | 'OVERRIDE' = 'WRAPPER'\r\n): number {\r\n    return libWrapper.register(MODULE_ID, target, fn, type)\r\n}\r\n","import { info } from '@utils/foundry/notification'\r\nimport { registerWrapper } from '@utils/libwrapper'\r\nimport { setModuleID } from '@utils/module'\r\n\r\nexport const MODULE_ID = 'pf2e-arp'\r\nsetModuleID(MODULE_ID)\r\n\r\nHooks.once('libWrapper.Ready', () => {})\r\n\r\nHooks.once('init', () => {\r\n    registerWrapper('CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareBaseData', onPrapareWeaponData, 'WRAPPER')\r\n    registerWrapper(\r\n        'CONFIG.PF2E.Item.documentClasses.weapon.prototype.getRunesValuationData',\r\n        onGetRunesValuationData,\r\n        'OVERRIDE'\r\n    )\r\n    registerWrapper('CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareBaseData', onPrepareArmorData, 'WRAPPER')\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    if (!game.user.isGM) return\r\n    if (game.settings.get('pf2e', 'automaticBonusVariant') !== 'noABP') {\r\n        game.settings.set('pf2e', 'automaticBonusVariant', 'noABP')\r\n        info('forceVariant')\r\n    }\r\n})\r\n\r\nfunction onPrepareArmorData(this: ArmorPF2e, wrapped: () => void) {\r\n    if (this.isShield) return wrapped()\r\n\r\n    const actor = this.actor\r\n    if (!actor || !actor.isOfType('character')) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    this.system.potencyRune.value = level < 5 ? null : level < 11 ? 1 : level < 18 ? 2 : 3\r\n    this.system.resiliencyRune.value =\r\n        level < 8 ? null : level < 14 ? 'resilient' : level < 20 ? 'greaterResilient' : 'majorResilient'\r\n\r\n    wrapped()\r\n}\r\n\r\nfunction onPrapareWeaponData(this: WeaponPF2e, wrapped: () => void) {\r\n    const actor = this.actor\r\n    if (!actor || !actor.isOfType('character')) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    const traits = this._source.system.traits.value\r\n    if (traits.includes('alchemical') && traits.includes('bomb')) return wrapped()\r\n\r\n    this.system.potencyRune.value = level < 2 ? null : level < 10 ? 1 : level < 16 ? 2 : 3\r\n    this.system.strikingRune.value = level < 4 ? null : level < 12 ? 'striking' : level < 19 ? 'greaterStriking' : 'majorStriking'\r\n\r\n    wrapped()\r\n}\r\n\r\nfunction onGetRunesValuationData(this: WeaponPF2e) {\r\n    const propertyRuneData = CONFIG.PF2E.runes.weapon.property\r\n    return this.system.runes.property.map(p => propertyRuneData[p])\r\n}\r\n"],"names":["TYPE","notify","str","arg1","arg2","arg3","type","data","undefined","permanent","ui","notifications","args","key","game","i18n","format","localize","registerWrapper","target","fn","libWrapper","register","onPrepareArmorData","wrapped","this","isShield","actor","isOfType","level","system","potencyRune","value","resiliencyRune","onPrapareWeaponData","traits","_source","includes","strikingRune","onGetRunesValuationData","propertyRuneData","CONFIG","PF2E","runes","weapon","property","map","p","id","isSystem","setModuleID","Hooks","once","user","isGM","settings","get","set"],"sourceRoot":""}